import { Meta, Canvas, Story } from '@storybook/addon-docs';

import { ThemedContainer } from '../../helpers';
import { useEffect, useState } from 'react';
import ReactDOMServer from 'react-dom/server';
import { Button } from '../../buttons';
import Text from '../../text/Text';
import Toggle from '../../Toggle/Toggle';
import { InfoWindow } from '../InfoWindow';
import { Marker } from '../Marker';
import Map from './Map';

<Meta title='Components/Map' parameters={{ options: { showToolbar: true } }} />

export const Template = (args) => {
	const coords = [
		{
			lat: 28,
			lng: 120,
		},
		{
			lat: 28.5,
			lng: 120,
		},
		{
			lat: 28.2,
			lng: 120,
		},
		{
			lat: 27,
			lng: 103,
		},
		{
			lat: 22,
			lng: 125,
		},
		{
			lat: 22,
			lng: 78,
		},
	];
	return (
		<ThemedContainer
			theme='light'
			style={{
				width: '100%',
				height: '100%',
			}}>
			<Map {...args}>
				{coords.map((position, index) => {
					return (
						<Marker
							key={`${position.lat}-${position.lng}`}
							position={position}
							title={`Location ${index + 1}`}>
							<InfoWindow
								content={ReactDOMServer.renderToString(
									<>
										<Button title='Map Title' />
										<Text component='p'>Location {index + 1}</Text>
									</>
								)}
							/>
						</Marker>
					);
				})}
			</Map>
		</ThemedContainer>
	);
};

export const WithNetworkCallTemplate = (args) => {
	const [coordinates, setCoordinates] = useState([]);
	useEffect(() => {
		setTimeout(() => {
			setCoordinates(coords);
		}, 1000);
	}, []);
	return (
		<Map {...args}>
			{coordinates.map((position, index) => {
				return (
					<Marker
						key={`${position.lat}-${position.lng}`}
						position={position}
						title={`Location ${index + 1}`}>
						<InfoWindow
							content={ReactDOMServer.renderToString(
								<>
									<Button title='hey' />
									<Text component='p'>Location {index + 1}</Text>
								</>
							)}
						/>
					</Marker>
				);
			})}
		</Map>
	);
};

export const DynamicTemplate = (args) => {
	const [selectedToggle, setSelectedToggle] = useState('1');
	const COORDS = {
		1: [
			{
				lat: 28,
				lng: 120,
			},
			{
				lat: 28.5,
				lng: 120,
			},
			{
				lat: 28.2,
				lng: 120,
			},
			{
				lat: 27,
				lng: 103,
			},
			{
				lat: 22,
				lng: 125,
			},
		],
		2: [
			{
				lat: 22,
				lng: 78,
			},
		],
		3: [
			{
				lat: 28,
				lng: 120,
			},
			{
				lat: 22,
				lng: 125,
			},
		],
	};
	const coordinates = COORDS[selectedToggle];
	return (
		<ThemedContainer
			style={{
				width: '100%',
				height: '100%',
				display: 'flex',
				flexDirection: 'column',
			}}>
			<Toggle
				options={[
					{
						value: '1',
						title: 'First',
					},
					{
						value: '2',
						title: 'Second',
					},
					{
						value: '3',
						title: 'Third',
					},
				]}
				value={selectedToggle}
				onChange={setSelectedToggle}
			/>
			<Map {...args}>
				{coordinates.map((position, index) => {
					return (
						<Marker
							key={`${position.lat}-${position.lng}`}
							position={position}
							title={`Location ${index + 1}`}>
							{' '}
						</Marker>
					);
				})}
			</Map>
		</ThemedContainer>
	);
};

# Map

The Map component is a higher-level wrapper that utilizes the Google Maps API to render maps with markers and clusters. It provides an easy-to-use interface for integrating maps into your React application.

#### Code - [Github](https://github.com/banyandata-cloud/roots/tree/main/components/maps/Map)

## Usage

Basic import and additional information on how to use this component.

```js
import { Map } from '@banyan_cloud/roots';
```

-   Ensure that you have obtained a valid Google Maps API key and have configured it properly in the apiKey prop.
-   The libraries prop allows you to load additional Google Maps libraries as needed (e.g., 'places' for Places API functionality).
-   The options prop allows you to customize the map's initial zoom level and center coordinates.

## Stories

The CSF rendered inside the `Canvas` from which you can see the implementation example.

### Default Map

The default Map component.

<Canvas>
	<Story
		name='Default'
		args={{
			apiKey: process.env.GOOGLE_MAPS_API_KEY,
			options: {
				style: {
					flexGrow: '1',
					height: '100%',
				},
				mapId: '20e2e511856fee45',
			},
		}}>
		{Template.bind({})}
	</Story>
</Canvas>

### Clustered Map

The clustered Map component.

<Canvas>
	<Story
		name='Clustered'
		args={{
			apiKey: process.env.GOOGLE_MAPS_API_KEY,
			options: {
				style: {
					flexGrow: '1',
					height: '100%',
				},
				mapId: '20e2e511856fee45',
				clustered: true,
			},
		}}>
		{Template.bind({})}
	</Story>
</Canvas>

### With Network Call

The Map component with network call capability.

<Canvas>
	<Story
		name='With Network Call'
		args={{
			apiKey: process.env.GOOGLE_MAPS_API_KEY,
			options: {
				style: {
					flexGrow: '1',
					height: '100%',
				},
				mapId: '20e2e511856fee45',
				clustered: true,
			},
		}}>
		{WithNetworkCallTemplate.bind({})}
	</Story>
</Canvas>

### Dynamic Coordinates

The Map component with dynamic coordinates.

<Canvas>
	<Story
		name='Dynamic Coordinates'
		args={{
			apiKey: process.env.GOOGLE_MAPS_API_KEY,
			options: {
				style: {
					flexGrow: '1',
					height: '100%',
				},
				mapId: '20e2e511856fee45',
				clustered: true,
			},
		}}>
		{DynamicTemplate.bind({})}
	</Story>
</Canvas>

### Restricted Bounds

The Map component with restricted bounds.

<Canvas>
	<Story
		name='Restricted Bounds'
		args={{
			apiKey: process.env.GOOGLE_MAPS_API_KEY,
			options: {
				style: {
					flexGrow: '1',
					height: '100%',
					restriction: {
						latLngBounds: {
							north: 90,
							south: -90,
							east: 189.999,
							west: -170,
						},
						strictBounds: true,
					},
					fitBounds: true,
				},
				mapId: '20e2e511856fee45',
				clustered: true,
			},
		}}>
		{DynamicTemplate.bind({})}
	</Story>
</Canvas>

## Try in the Code Editor

This embeded `CodeSandBox` is external third party code editor `iframe` shared publicly. It is advised to create an account with banyancloud mail id to create/fork this sandbox.

## API

**`loading`**

If true, displays a loading indicator while the map is being loaded.

<table style={{ width: '100%' }}>
	<tr>
		<th style={{ textAlign: 'left', width: '50%' }}>TYPE</th>
		<th style={{ textAlign: 'left', width: '50%' }}>DEFAULT</th>
	</tr>
	<tr>
		<td>Boolean</td>
		<td>false</td>
	</tr>
</table>

```jsx
<Map loading={true} />
```

**`apiKey`**

The Google Maps API key for accessing the map services.

<table style={{ width: '100%' }}>
	<tr>
		<th style={{ textAlign: 'left', width: '50%' }}>TYPE</th>
		<th style={{ textAlign: 'left', width: '50%' }}>DEFAULT</th>
	</tr>
	<tr>
		<td>String</td>
		<td>null</td>
	</tr>
</table>

```jsx
<Map apiKey='your-api-key' />
```

**`libraries`**

An array of Google Maps libraries to be loaded.

<table style={{ width: '100%' }}>
	<tr>
		<th style={{ textAlign: 'left', width: '50%' }}>TYPE</th>
		<th style={{ textAlign: 'left', width: '50%' }}>DEFAULT</th>
	</tr>
	<tr>
		<td>Array of string</td>
		<td>undefined</td>
	</tr>
</table>

```jsx
<Map libraries={['library1', 'library2']} />
```

**`theme`**

An array of Google Maps libraries to be loaded.

<table style={{ width: '100%' }}>
	<tr>
		<th style={{ textAlign: 'left', width: '50%' }}>TYPE</th>
		<th style={{ textAlign: 'left', width: '50%' }}>DEFAULT</th>
	</tr>
	<tr>
		<td>'light', 'dark'</td>
		<td>'dark'</td>
	</tr>
</table>

```jsx
<Map theme='light' />
```

**`fallback`**

If set to true, the loading animation will not be shown when loading is false.

<table style={{ width: '100%' }}>
	<tr>
		<th style={{ textAlign: 'left', width: '50%' }}>TYPE</th>
		<th style={{ textAlign: 'left', width: '50%' }}>DEFAULT</th>
	</tr>
	<tr>
		<td>Boolean</td>
		<td>undefined</td>
	</tr>
</table>

```jsx
<Map fallback={true} />
```

**`options`**

An object containing additional options for configuring the map, such as zoom, center, and other properties accepted by the Google Maps API.

<table style={{ width: '100%' }}>
	<tr>
		<th style={{ textAlign: 'left', width: '50%' }}>TYPE</th>
		<th style={{ textAlign: 'left', width: '50%' }}>DEFAULT</th>
	</tr>
	<tr>
		<td>Object</td>
		<td>null</td>
	</tr>
</table>

```jsx
<Map
	options={{
		style: {
			flexGrow: '1',
			height: '100%',
		},
	}}
/>
```

**`children`**

Child components, such as markers or other map-related elements, to be rendered within the map.

<table style={{ width: '100%' }}>
	<tr>
		<th style={{ textAlign: 'left', width: '50%' }}>TYPE</th>
		<th style={{ textAlign: 'left', width: '50%' }}>DEFAULT</th>
	</tr>
	<tr>
		<td>React Node</td>
		<td>null</td>
	</tr>
</table>

```jsx
<Map>{children}</Map>
```
